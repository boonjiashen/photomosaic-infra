<!DOCTYPE html>
<html>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <body>
        <img />
        <p>Under construction.</p>
        <input type="file" accept="image/png, image/jpeg"><br />
        <script type="text/javascript">
            function get_fetch_url() {
                LOCAL_DOMAINS = ["localhost", "127.0.0.1"]
                LOCAL_URL = "http://localhost:8080/2015-03-31/functions/function/invocations"
                EXTERNAL_URL = "https://owtyai55r3.execute-api.ap-northeast-1.amazonaws.com/"

                if (LOCAL_DOMAINS.includes(location.hostname)) {
                    return LOCAL_URL;
                }
                return EXTERNAL_URL;
            }
            const fetch_url = get_fetch_url()
            console.log("fetch_url = ", fetch_url)

            // To add image to DOM, see https://stackoverflow.com/a/45931408
            document.querySelector('input[type="file"]').addEventListener('change', function() {
                if (!this.files || !this.files[0]) {
                    return
                }
                var image = new Image();
                var file = this.files[0]
                image.src = URL.createObjectURL(file);
                document.body.appendChild(image);

                fetch(get_fetch_url(), {
                    method: 'POST',
                    body: file,
                })
                .then(response => response.blob())
                .then(blob => {
                    var image = new Image();
                    image.src = URL.createObjectURL(blob);
                    document.body.appendChild(image);
                    console.log(blob)
                });
            });
        </script>
    </body>
</html>
